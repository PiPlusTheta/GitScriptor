
# üíé  **Ultimate Scaffold Spec ‚Äì GitScriptor‚ÄëWeb¬†v2**

**Updated:** 2025‚Äë06‚Äë23¬†IST

> **Purpose**  
> This single document is the *source of truth* that ANY code‚Äëgeneration assistant (Copilot, ChatGPT, etc.) must follow to create the **first working commit** of the GitScriptor‚ÄëWeb mono‚Äërepo **from a completely empty folder**.  
> The instructions are *ultra‚Äëexplicit*, assume the assistant has **zero prior context**, and require **no human gap‚Äëfilling**.

---

## üìå 1. Absolute Goals (MUST)

1. **Browser UX:** A page at `http://localhost:5173` where a user pastes a public Git URL and sees a generated `README.md` in under 2‚ÄØmin.
2. **Single command spin‚Äëup:** `docker compose up --build` works on macOS, Linux, and Windows WSL with no extra flags.
3. **Shared core package:** All README logic lives in `packages/gitscriptor_core` and is imported by the FastAPI backend **only**.
4. **Good defaults:** Code compiles with zero linter errors; all tests pass (`npm test`, `poetry run pytest`).

---

## üìÇ 2. Mandatory Folder / File Map

> **Generate every file exactly once** and **match casing & paths**:

```
GitScriptor-Web/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web-frontend/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ theme.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vite.config.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ routers/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate.py
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ services/generator.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ alembic/
‚îÇ       ‚îú‚îÄ‚îÄ tests/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îî‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îî‚îÄ‚îÄ gitscriptor_core/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ __main__.py
‚îÇ       ‚îî‚îÄ‚îÄ agents.py
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .github/workflows/ci.yml
‚îî‚îÄ‚îÄ README.md
```

*If any file is long (>40‚ÄØLOC) show first 40 lines then `# ‚Ä¶` placeholder.*

---

## üîÑ 3. Shared Core (`packages/gitscriptor_core`)

### 3.1 Interface

```python
# __init__.py
from pathlib import Path
from .agents import generate_readme  # re‚Äëexport
__all__ = ["generate_readme"]
```

```python
# agents.py   (MINIMUM CONTENT)
def generate_readme(repo_path: str | Path, *, style: str = "classic") -> str:
    """Return a placeholder README until real agents are added."""
    return f"""# Draft README

This is an autogenerated README for **{repo_path}** (style: {style}).
"""
```

```python
# __main__.py
import argparse
from .agents import generate_readme

if __name__ == "__main__":
    ap = argparse.ArgumentParser()
    ap.add_argument("git_url")
    args = ap.parse_args()
    print(generate_readme(args.git_url))
```

*No external deps except **GitPython¬†>=3** (declare in `pyproject.toml` later).*

---

## üêç 4. Backend (`apps/api`)

### 4.1 `pyproject.toml` essentials
```toml
[tool.poetry]
name = "gitscriptor-api"
version = "0.1.0"
packages = [{include = "src"}]

[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.110.0"
uvicorn = "^0.29.0"
sqlalchemy = "^2.0"
asyncpg = "^0.29.0"
pydantic = "^2.7"
python-dotenv = "^1.0"
gitscriptor_core = {path = "../../packages/gitscriptor_core", develop = true}

[tool.poetry.group.dev.dependencies]
pytest = "^8.2"
httpx = "^0.27"
ruff = "^0.4"
black = "^24.4"
```

### 4.2 `src/main.py` (excerpt ‚Äì keep <40 LOC)
```python
from fastapi import FastAPI
from .routers import generate, health

app = FastAPI(title="GitScriptor‚ÄëAPI")
app.include_router(generate.router)
app.include_router(health.router)
```

### 4.3 Router requirements (generate.py)
1. Parse JSON body `{"repo_url": str}`.
2. Validate URL via regex.
3. Use `tempfile.TemporaryDirectory` + `subprocess.run(["git", "clone", "--depth", "1", repo_url, tmp], ...)`.
4. Start timer; call `generate_readme(tmp_path)`.
5. Return `{"markdown": "...", "elapsed_ms": 1234}` as Pydantic model.

---

## ‚öõÔ∏è 5. Frontend (`apps/web-frontend`)

### 5.1 `package.json` scripts
```json
{
  "name": "gitscriptor-web-frontend",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint "src/**/*.{ts,tsx}" --max-warnings=0",
    "test": "vitest run"
  },
  ...
}
```

### 5.2 Components
* `RepoInput.tsx` ‚Äì MUI `TextField`, `Button`, inline regex validation.
* `ReadmeViewer.tsx` ‚Äì render markdown via `@uiw/react-markdown-preview`, theme‚Äëaware.
* Loading state via `LoadingBackdrop.tsx` ‚Äì MUI `Backdrop` + `CircularProgress`.

### 5.3 Hooks
`useGenerateReadme.ts` ‚Äì wraps React Query mutation.

---

## üê≥ 6. Docker Compose (root)

*(unchanged from v1 spec; ensure healthchecks and depends_on).*

---

## ‚úÖ 7. Acceptance Checklist

* Local compose spins up DB ‚Üí API ‚Üí FE, returns README for `https://github.com/tiangolo/fastapi`.
* `npm run lint`, `npm run test`, `poetry run ruff .`, `poetry run pytest` all succeed.
* `curl -s http://localhost:8000/health` returns `{"ok": true}`.

---

## üö® 8. Output Rules (STRICT)

1. Output each file once in a fenced code block **with the path header**:  
   ```path: apps/api/src/main.py
   (code)
   ```
2. Follow directory order.  
3. Truncate boilerplate >40 lines with `# ‚Ä¶` comment.  
4. No explanations‚Äî**only file contents**.  
5. Finish with the exact text: `# End of scaffold`.

If compliance is impossible, assistant must abort.

---

# End of Ultimate Scaffold Spec v2
